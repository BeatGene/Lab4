# 测试时间
2025/12/1 

# 测试人员
夏庭浩

# 测试内容
## Lab1

#### 1. `load` - 加载文件

```bash
load <file>
```

**功能**：加载文件。✔

**行为**:
- 文件已存在：读取并解析内容 ✔
- 文件不存在：创建新文件，标记为已修改 ✔
- 文件成为当前活动文件 ✔

---

#### 2. `save` - 保存文件

```bash
save [file|all]
```

**功能**：保存文件内容到磁盘。✔

**参数说明**:

- 不指定参数：保存当前活动文件✔
- `file`：保存指定文件✔
- `all`：保存所有已打开的文件✔

**行为**:
- 保存成功后清除已修改标记✔
- 若路径无法写入，提示错误信息✔

---

#### 3. `init` - 创建新缓冲区

```bash
init <file> [with-log]
```

**功能**：创建一个未保存的新缓冲文件，并初始化基础结构。✔

**参数说明**:

- `file`：创建纯文本文件✔
- `with-log`(可选)：是否在第一行添加 `# log` 以启用日志✔

**初始化内容**:

创建文本文件(`init test.text with-log`):
```txt
# log
```

**说明:**

- 新缓冲区标记为已修改，需要使用 `save` 命令指定路径保存✔
- 创建后自动成为当前活动文件✔

---

#### 4. `close` - 关闭文件

```bash
close [file]
```

**功能**：关闭当前活动文件或指定文件。✔

**行为**:
- 文件已修改且未保存：提示"文件已修改，是否保存? (y/n)"✔
- 关闭后，如果还有其他打开的文件，切换到最近使用的文件✔

---

#### 5. `edit` - 切换活动文件

```bash
edit <file>
```

**功能**：切换当前活动文件。✔

**行为**:
- 文件必须已在工作区中打开✔
- 切换失败提示："文件未打开: [file]"✔

---

#### 6. `editor-list` - 显示文件列表

```bash
editor-list
```

**功能**：显示工作区中所有打开的文件及其状态。✔

**显示格式(可选以下任一种)**:

**格式1**:
```
* file1.txt [modified]
  file2.txt
```

**格式2**:

```
> file1.txt*
  file2.txt
```

**说明**:
- **当前活动文件标记**：`*` (格式1)或 `>` (格式2)
- **已修改未保存标记**：`[modified]` (格式1)或后缀 `*` (格式2)

---

#### 7. `dir-tree` - 显示工作目录文件树

```bash
dir-tree [path]
```

**功能**：以树形结构显示当前工作目录(或指定目录)的文件和文件夹。✔

**参数说明**:
- 不指定参数：显示当前工作目录✔
- `path`：指定要显示的目录路径✔

**显示格式**:
```
├── visitor
│   ├── visitor.worksheet.sc
│   ├── visitor.scala
│   ├── README.md
│   ├── diagram.md
│   └── livedemo
│       ├── visitor.scala
│       └── livedemo.worksheet.sc
└── strategy
    ├── README.md
    ├── livedemo
    │   ├── strategy.scala
    │   └── strategy.worksheet.sc
    ├── strategy.scala
    └── strategy.worksheet.sc
```

**说明**:
- 使用 `├──`、`└──` 和 `│` 字符绘制树形结构
- 显示目录和文件的层级关系

---

#### 8. `undo` - 撤销

```bash
undo
```

**功能**：撤销上一次编辑操作。✔

**说明**:
- 只撤销会改变文件状态的命令✔
- 显示类命令(show、dir-tree、editor-list等)不进入撤销栈✔

---

#### 9. `redo` - 重做

```bash
redo
```

**功能**：重做上一次撤销的操作。✔

---

#### 10. `exit` - 退出程序

```bash
exit
```

**功能**：退出编辑器程序。✔

**行为**:
- 保存工作区状态到配置文件✔
- 若有未保存的文件，逐一提示是否保存✔



### 2.2 文本编辑命令

#### 1. `append` - 追加文本

```bash
append "text"
```

**功能**：在文件末尾追加一行文本。✔

**示例**:
```
原文:
Hello world

执行: append "New line"

结果:
Hello world
New line
```

---

#### 2. `insert` - 插入文本

```bash
insert <line:col> "text"
```

**功能**：在指定位置插入文本。✔

**参数说明**:
- `line`：行号(从1开始)✔
- `col`：列号(从1开始，表示插入到第几个字符前)✔
- `"text"`：要插入的文本内容✔

**行为说明**:
- 插入位置在现有字符之前✔
- 文本中可以包含换行符(`\n`)，将自动拆分为多行✔

**异常处理**:
- 行号或列号越界：提示"行号或列号越界"
- 空文件插入非1:1位置：提示"空文件只能在1:1位置插入"

**示例**:
```
原文:
abcdef

执行: insert 1:4 "XYZ"

结果:
abcXYZdef
```

---

#### 3. `delete` - 删除字符

```bash
delete <line:col> <len>
```

**功能**：从 `line:col` 位置开始，删除连续 `len` 个字符。✔

**行为说明**:
- 删除范围**不可跨行**
- 删除长度不可超过该行剩余字符数

**异常处理**:
- 删除长度超出该行剩余字符：提示"删除长度超出行尾"
- 行号或列号越界：提示相应的范围错误

**示例**:
```
原文:
Hello world

执行: delete 1:7 5

结果:
Hello 
```

---

#### 4. `replace` - 替换字符

```bash
replace <line:col> <len> "text"
```

**功能**：删除从指定位置起 `len` 个字符，并插入 `"text"`。✔

**行为说明**:
- 等效于先执行 `delete`，再执行 `insert`
- 替换文本可为空字符串，效果等同于删除✔

**示例**:
```
原文:
fast fox

执行: replace 1:1 4 "slow"

结果:
slow fox
```

---

#### 5. `show` - 显示文本内容

```bash
show [startLine:endLine]
```

**功能**：显示文本编辑器中指定范围的内容(按行)。✔

**参数说明**:
- 不指定参数：显示全文✔
- `startLine`：起始行号(从1开始)✔
- `endLine`：结束行号(包含)✔

**适用对象**：仅适用于文本编辑器(`.txt` 文件)

**示例**:
```bash
> show
1: Hello world
2: This is line 2
3: This is line 3

> show 1:2
1: Hello world
2: This is line 2
```

**说明**：显示类命令不改变文件状态，不进入撤销栈



### 2.3 日志命令

#### 1. `log-on` - 启用日志

```bash
log-on [file]
```

**功能**：为指定文件(或当前活动文件)启用日志记录。✔

**参数说明**:
- 不指定参数：为当前活动文件启用日志✔
- `file`：为指定文件启用日志✔

**行为说明**:
- 后续该文件的所有编辑操作、保存行为将被记录到 `.filename.log` 文件中✔
- 如果文件首行已是 `# log`，可自动启用

---

#### 2. `log-off` - 关闭日志

```bash
log-off [file]
```

**功能**：关闭对指定文件(或当前活动文件)的日志记录。✔

**参数说明**:
- 不指定参数：关闭当前活动文件的日志✔
- `file`：关闭指定文件的日志✔

**行为说明**:
- 停止监听该文件的日志事件，但不删除已有日志✔

---

#### 3. `log-show` - 显示日志

```bash
log-show [file]
```

**功能**：显示指定文件(或当前活动文件)的日志记录。

**参数说明**:
- 不指定参数：显示当前活动文件的日志✔
- `file`：显示指定文件的日志✔

**输出格式**：显示 `.filename.log` 文件的内容。


## 二、 命令设计

### 2.1 工作区命令

#### 1. `init` - 创建新缓冲区

```bash
init <text|xml> [with-log]
```

**功能**：创建一个未保存的新缓冲文件，并初始化基础结构。✔

**参数说明**:

- `text`：创建纯文本文件✔
- `xml`：创建XML文件，写入合法的空结构✔
- `with-log`(可选)：是否在第一行添加 `# log` 以启用日志

**初始化内容**:

创建文本文件(`init text with-log`):

```txt
# log
```

创建XML文件(`init xml`):

```xml
<?xml version="1.0" encoding="UTF-8"?>
<root id="root">
</root>
```

**说明**:

- 新缓冲区标记为已修改，需要使用 `save` 命令指定路径保存✔
- 创建后自动成为当前活动文件✔

#### 2. `editor-list` - 显示文件列表

```bash
editor-list
```

**功能**：显示工作区中所有打开的文件及其状态。✔

**显示格式(可选以下任一种)**:

**格式1**:

```
* file1.txt [modified] (2小时15分钟)
  file2.xml (45秒)
```

**格式2**:

```
> file1.txt* (2小时15分钟)
  file2.xml (45秒)
```

**说明**:

- **当前活动文件标记**：`*` (格式1)或 `>` (格式2)✔

- **已修改未保存标记**：`[modified]` (格式1)或后缀 `*` (格式2)✔

- **编辑时长**：括号内显示当前会话中的编辑时长✔



### 2.2 XML编辑命令

#### 1. `insert-before` - 插入元素

```bash
insert-before <tagName> <newId> <targetId> ["text"]
```

**功能**：在目标元素前(同级)插入一个新元素。✔

**参数说明**:

- `tagName`：新插入元素的标签名
- `newId`：新元素的唯一ID，不可与已有元素重复
- `targetId`：目标元素的ID，新元素将被插入到该元素前
- `"text"`：可选，新元素的文本内容

**异常处理**:

- `newId` 已存在：提示"元素ID已存在: [newId]"
- `targetId` 不存在：提示"目标元素不存在: [targetId]"
- 尝试在根元素前插入：提示"不能在根元素前插入元素"

**示例**:

```bash
insert-before book newBook book1 ""
```

#### 2. `append-child` - 追加子元素

```bash
append-child <tagName> <newId> <parentId> ["text"]
```

**功能**：在某元素内追加一个子元素(作为最后一个子元素)。✔

**参数说明**:

- `tagName`：要追加的子元素标签名
- `newId`：子元素ID，需唯一
- `parentId`：父元素ID
- `"text"`：可选，子元素的文本内容

**异常处理**:

- `parentId` 无效：提示"父元素不存在: [parentId]"
- `newId` 重复：提示"元素ID已存在: [newId]"

**示例**:

```bash
append-child price price4 book1 "29.99"
```

#### 3. `edit-id` - 修改元素ID

```bash
edit-id <oldId> <newId>
```

**功能**：修改某个元素的ID。✔

**参数说明**:

- `oldId`：原始ID，必须存在
- `newId`：目标ID，必须未被占用

**异常处理**:

- `oldId` 不存在：提示"元素不存在: [oldId]"
- `newId` 已被占用：提示"目标ID已存在: [newId]"
- 尝试修改根元素ID：提示"不建议修改根元素ID"

**示例**:

```bash
edit-id book1 book001
```

#### 4. `edit-text` - 修改元素文本

```bash
edit-text <elementId> ["text"]
```

**功能**：修改某元素的文本内容。✔

**参数说明**:

- `elementId`：元素的ID
- `"text"`：新文本内容(可选)，若为空字符串或省略则清空原内容

**异常处理**:

- `elementId` 不存在：提示"元素不存在: [elementId]"

**示例**:

```bash
edit-text title1 "New Book Title"
```

#### 5. `delete` - 删除元素

```bash
delete <elementId>
```

**功能**：删除指定ID的元素(包括其所有子元素)。✔

**异常处理**:

- `elementId` 不存在：提示"元素不存在: [elementId]"
- 尝试删除根元素：提示"不能删除根元素"

**示例**:

```bash
delete book1
```

#### 6. `xml-tree` - 显示XML树形结构

```bash
xml-tree [file]
```

**功能**：以树形结构打印XML文件内容，展示元素的层级关系、属性和文本内容。

**参数说明**:

- 不指定参数：显示当前活动文件
- `file`：显示指定XML文件

**适用对象**：仅适用于XML编辑器(`.xml` 文件)

**输出格式要求**:

- 使用树形字符(`├──`、`└──`、`│`)或缩进表示层级关系
- 显示元素的所有属性(包括id)
- 显示元素的文本内容(如果有)

**示例**:

原XML文件:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<bookstore id="root">
    <book id="book1" category="COOKING">
        <title id="title1" lang="en">Everyday Italian</title>
    </book>
</bookstore>
```

输出:

```
bookstore [id="root"]
├── book [id="book1", category="COOKING"]
│   └── title [id="title1", lang="en"]
│       └── "Everyday Italian"
```



**说明**：两种格式均可，推荐使用树形字符以获得更好的可视化效果。显示类命令不改变文件状态，不进入撤销栈

#### 

### 2.3 拼写检查命令

#### 1. `spell-check` - 拼写检查

```bash
spell-check [file]
```

**功能**：检查文本文件、xml文件中的拼写错误。

**参数说明**:

- 不指定参数：检查当前活动文件
- `file`：检查指定文本文件

**输出格式参考**:

```
拼写检查结果:
第1行，第5列: "recieve" -> 建议: receive
第3行，第12列: "occured" -> 建议: occurred
```

```
拼写检查结果:
元素 title1: "Itallian" -> 建议: Italian
元素 author2: "Rowlling" -> 建议: Rowling
```


